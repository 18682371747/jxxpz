<!DOCTYPE html>
<html class="pixel-ratio-1 pixel-ratio-2 retina android android-6 android-6-0">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="theme-color" content="#1f212f">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="cache-control" content="max-age=864000">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="author" content="">
    <meta name="description" content="">
    <meta itemprop="name" content="">
    <meta itemprop="description" content="">
    <title>凭证详情</title>
    <script type="text/javascript">
        window.Error = function(message, url) {
            alert('验证文件加载失败，请刷新页面重新加载',
                function() {
                    location.reload();
                });
        }
    </script>
    <link rel="stylesheet" href="../css/layer.css" id="layuicss-layer">
</head>

<body class="">
    <div id="divQRCode" class="tips-container hide" style="display: none;">
        <!-- <div style="text-align:center;">
            <img src="../imgs/detailcode2.jpg" style="height:300px;width:300px;">
        </div>
        <div class="qrcode-text">
            <p>让出借人扫扫这个二维码</p>
        </div>
        <button id="btnQRCodeClose" type="button" class="btn-qrcode-close">
            <span class="fa fa-check mr5"></span>知道啦
        </button> -->
    </div>
    <div id="divShare" class="tips-container hide">
        <div style="text-align:center;">
            <img src="../imgs/jt.png" style="position:relative;top:0px;left:130px;height:100px;width:100px;">
        </div>
        <div class="qrcode-text">
            <p>点击右上角分享给对方</p>
        </div>
        <button id="btnShareClose" type="button" class="btn-qrcode-close">
            <span class="fa fa-check mr5"></span>知道啦
        </button>
    </div>
    <div id="divMobilePay" class="tips-container hide">
        <img src="../imgs/jt.png" class="mobilepay-arrow">
        <div class="mobilepay-text">
            <p>请选择</p>
            <p>在手机浏览器中打开</p>
            <p>再使用其他方式支付</p>
        </div>
        <button id="btnMobilePayClose" type="button" class="btn-mobilepay-close">
            <span class="fa fa-check mr5"></span>知道啦
        </button>
    </div>
    <form action="#" id="formUpdateStatus" method="post" novalidate="novalidate">
        <input data-val="true" data-val-number="字段 凭证Id 必须是一个数字。" data-val-required="请输入凭证Id" id="Id" name="Id" type="hidden" value="1063">
        <input data-val="true" data-val-number="字段 凭证Id 必须是一个数字。" data-val-required="交易密码" id="Password" name="Password" type="hidden" value="92ce1af6795fb524a3e8aa0bae2b1a2a">
        <div class="container">
            <a id="btnQRCode" href="#" class="icon-qrcode">
            </a>
            <div class="weui-flex text-center">
                <div class="weui-flex__item">
                    <div class="head-img-container">


                        <img src="../imgs/user.png" class="head-img">

                    </div>
                    <div class="user-name" id="cjr"></div>
                </div>
                <div class="weui-flex__item to">
                    <span class="fa fa-angle-double-right mr5"></span>借款给
                    <span class="fa fa-angle-double-right ml5"></span>
                </div>
                <div class="weui-flex__item">
                    <div class="head-img-container" style="position: relative;">
                        <img id="imgDebtorHeadImage" src="../imgs/user.png" class="head-img">
                    </div>
                    <div class="user-name" id="jkr"></div>
                </div>
            </div>
            <div class="weui-cells mt15">
                <div class="weui-cell_border"></div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">借款日期</div>
                    <div class="weui-cell__ft text-dark" id="jkrq"></div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">还款日期</div>
                    <div class="weui-cell__ft text-dark" id="hkrq"></div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">借款金额</div>
                    <div class="weui-cell__ft text-currency">
                        <span id="jkje">
                        </span>
                        <span class="text-xs">元</span>
                    </div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">年化利率</div>
                    <div class="weui-cell__ft text-dark">
                        <span id="nhll"></span>
                        <!-- <span class="text-xs">%</span> -->
                    </div>
                </div>
                <!-- <div class="weui-cell">
                    <div class="weui-cell__bd">本息共计</div>
                    <div class="weui-cell__ft text-currency">
                        <span id="bxgj"></span>
                        <span class="text-xs">元</span>
                    </div>
                </div> -->
                <div class="weui-cell">
                    <div class="weui-cell__bd">借款用途</div>
                    <div class="weui-cell__ft text-dark" id="jkyt"></div>
                </div>
                <div class="weui-cell_border"></div>
                <div class="weui-cell">
                    <div class="weui-cell__bd">平台服务费</div>
                    <div class="weui-cell__ft text-dark">
                        <span id="ptfwf"></span>
                        <span class="text-xs">元</span>
                    </div>
                </div>


            </div>
        </div>

        <div id="divAction" class="weui-submit-area">
            <div class="weui-flex__item weui-flex__item-2" style="margin-bottom:10px;">
                <button id="btnConfirm" class="btn btn-success" type="button" data-status="Destroyed">
                    确认凭证
                </button>
            </div>
            <div class="weui-flex__item weui-flex__item-2" style="margin-bottom:10px;">

                <button id="btndel" class="btn btn-success" type="button" data-status="Destroyed">
                    销毁凭证
                </button>

            </div>
            <div class="weui-flex__item weui-flex__item-2">

                <button id="btnShare" class="btn btn-success" type="button" data-status="Destroyed">
                    分享凭证
                </button>
            </div>

        </div>





    </form>

    <link rel="stylesheet" type="text/css" href="../css/weui.min.css">
    <link rel="stylesheet" type="text/css" href="../css/jquery-weui.min.css">
    <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../css/ym.ypz.mobile.css">
    <link rel="stylesheet" type="text/css" href="../css/ym.ypz.mobile.extension.css">
    <link rel="stylesheet" type="text/css" href="../css/renderIOU.css">
    <link rel="stylesheet" type="text/css" href="../css/info.css">
    <script type="text/javascript" src="../js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="../js/jquery.transit.js"></script>
    <script type="text/javascript" src="../js/jquery.validate.min.js"></script>
    <script type="text/javascript" src="../js/jquery.validate.unobtrusive.min.js"></script>
    <script type="text/javascript" src="../js/jweixin-1.2.0.js"></script>
    <script type="text/javascript" src="../js/jquery-weui.min.js"></script>
    <script type="text/javascript" src="../js/crypto-js.js"></script>
    <script type="text/javascript" src="../js/ym.ypz.jquery.validate.unobtrusive.js"></script>
    <script type="text/javascript" src="../js/ym.ypz.enum.mapping.js"></script>
    <script type="text/javascript" src="../js/ym.ypz.form.js"></script>
    <script type="text/javascript" src="../js/ym.ypz.mobile.js"></script>
    <script type="text/javascript" src="../js/md5.js"></script>
    <script type="text/javascript" src="../js/layer.js"></script>


    <script type="text/javascript">
    </script>
    <script>
        $(function() {
            function getRequest() {
                var url = location.search; //获取url中"?"符后的字串   
                var theRequest = new Object();
                if (url.indexOf("?") != -1) {
                    var str = url.substr(1);
                    strs = str.split("&");
                    for (var i = 0; i < strs.length; i++) {
                        theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
                    }
                }
                return theRequest;
            }

            function getDetail() {
                let userInfo = sessionStorage.getItem('userInfo');
                userInfo = JSON.parse(userInfo);
                if (!userInfo) {
                    location.href = 'login.html';
                }
                $.ajax({
                    url: "http://39.106.11.92:8080/lgFace/proof/getProofDetail",
                    data: {
                        id: getRequest().id,
                        userId: userInfo.id,
                        token: userInfo.token,
                    },
                    type: "POST",
                    dataType: 'jsonp',
                    success: function(res) {
                        if (res.code == 99) {
                            // location.href = 'login.html';
                        }
                        $("#cjr").html(res.proof.cjr);
                        $("#jkr").html(res.proof.jkr);
                        $("#jkrq").html(res.proof.jkrq);
                        $("#hkrq").html(res.proof.hkrq);
                        $("#jkje").html(res.proof.jkje);
                        $("#nhll").html(res.proof.nhll + "%");

                        $("#jkrq").html(res.proof.jhrq);

                        $("#jkyt").html(res.proof.yt);
                        $("#ptfwf").html(res.proof.fwf);
                        res.proof;

                    }
                });
            };
            getDetail();
            $("#btnQRCode").on({
                click: function() {
                    $("#divQRCode").show();
                    $("body").addClass("overflow-y")
                }
            });
            $("#btnQRCodeClose").on({
                click: function() {
                    $("#divQRCode").hide();
                    $("body").removeClass("overflow-y")
                }
            });
            $("#btnShare").on({
                click: function() {
                    $("#divShare").show();
                    $("body").addClass("overflow-y")
                }
            });
            $("#btnShareClose").on({
                click: function() {
                    $("#divShare").hide();
                    $("body").removeClass("overflow-y")
                }
            });
            $("#btnConfirm").on({
                click: function() {
                    let userInfo = sessionStorage.getItem('userInfo');
                    userInfo = JSON.parse(userInfo);
                    if (!userInfo) {
                        location.href = 'login.html';
                    }
                    $.ajax({
                        url: "http://39.106.11.92:8080/lgFace/proof/updateManageProof",
                        data: {
                            id: getRequest().id,
                            sfqr: 1,
                            userId: userInfo.id,
                            token: userInfo.token,
                        },
                        type: "POST",
                        dataType: 'jsonp',
                        success: function(res) {
                            location.href = "index.html"
                        }
                    })
                }
            });
            $("#btndel").on({
                click: function() {
                    let userInfo = sessionStorage.getItem('userInfo');
                    userInfo = JSON.parse(userInfo);
                    if (!userInfo) {
                        location.href = 'login.html';
                    }
                    $.ajax({
                        url: "http://39.106.11.92:8080/lgFace/proof/updateManageProof",
                        data: {
                            id: getRequest().id,
                            sfqr: 3,
                            userId: userInfo.id,
                            token: userInfo.token,
                        },
                        type: "POST",
                        dataType: 'jsonp',
                        success: function(res) {
                            location.href = "index.html"
                        }
                    })
                }
            });
            // 已还清,更新状态
            $("#destroyedBtn").on({
                click: function() {
                    /*$.appAjax({
                        url: "../m/savePayOff.html",
                        data: {
                            id: $('#Id').val()
                        },
                        onSuccess: function(data) {
                            if(data.result == 'success'){
                                $.toast("操作成功!", "text");
                                location.href = "../m/toMyCredent.html";
                            }else{
                                $.toast("操作失败!", "text");
                            }
                        }
                    });*/


                    //弹出密码框
                    //页面层
                    layer.open({
                        type: 1,
                        title: '输入交易密码',
                        area: ['300px', '240px'], //宽高
                        btn: '验证密码', //可以无限个按钮 
                        content: '<div class="dialog"><div class="text-xs">请确认您已收到借款，一经撕毁不可修改</div>' +
                            '<div class="row"><input class="form-control" id="Pass" name="Pass" placeholder="请输入你的交易密码" type="password"></div>' +
                            '<div class="text-xs">温馨提示</div>' +
                            '<div style = "font-size: 12px; color:#FF0000">禁止学生使用</div></div>',
                        yes: function(index, layero) {
                            var pass = (layero).find('input').val();
                            if (MD5(pass) == $('#Password').val()) {
                                layer.close(index);

                                $.appAjax({
                                    url: "../m/savePayOff.html",
                                    data: {
                                        id: $('#Id').val()
                                    },
                                    onSuccess: function(data) {
                                        if (data.result == 'success') {
                                            $.toast("操作成功!", "text");
                                            location.href = "../m/toMyCredent.html";
                                        } else {
                                            $.toast("操作失败!", "text");
                                        }
                                    }
                                });


                            } else {
                                layer.msg("交易密码输入错误，请重新输入");
                            }
                        }
                    });


                }
            });

            // 删除凭证
            $("#deleteBtn").on({
                click: function() {
                    $.appAjax({
                        url: "../m/deleteCredent.html",
                        data: {
                            id: $('#Id').val()
                        },
                        onSuccess: function(data) {
                            if (data.result == 'success') {
                                alert('操作成功!');
                                // location.href = "../m/toMyCredent.html";
                            } else {
                                alert('操作失败!');
                            }
                        }
                    });
                }
            });


        });
    </script>

</body>

</html>